"use strict";angular.module("angularCesium",["observableCollection"]),angular.module("angularCesium").service("BillBoardAttributes",["$parse",function(e){this.calcAttributes=function(t,n){var o={image:e(t.image)(n)},i=e(t.position)(n);o.position=Cesium.Cartesian3.fromDegrees(Number(i.latitude)||0,Number(i.longitude)||0,Number(i.altitude)||0);var r=e(t.color)(n);return r&&(o.color=Cesium.Color.fromCssColorString(r)),o}}]),angular.module("angularCesium").factory("Cesium",function(){return Cesium}),function(e){e.module("angularCesium").factory("Proxy",[function(){function e(e,t){if(null===e||"object"!=typeof e&&"function"!=typeof e)throw new TypeError("Target must be object or function.");if(void 0!==t){if(null===t||"object"!=typeof t)throw new TypeError("Handler mut be object");if("function"==typeof e){if("function"!=typeof t.apply)return;return function(){for(var n=[],o=0;o<arguments.length;o++)n[o]=arguments[o];return t.apply(e,this,n)}}if("function"==typeof t.get||"function"==typeof t.set){var n=this,o=function(o){var i={};void 0!==t.get&&(i.get=function(){return t.get(e,o)}),void 0!==t.set&&(i.set=function(n){t.set(e,o,n)}),Object.defineProperty(n,o,i)};for(var i in e)o(i)}}}return e}])}(window.angular),function(e){e.module("angularCesium").factory("Tool",[function(){var e=function(){};return $traceurRuntime.createClass(e,{start:function(){throw"No implementation"},stop:function(){throw"No implementation"},cancel:function(){throw"No implementation"},onUpdate:function(){throw"No implementation"}},{}),e}])}(window.angular),angular.module("angularCesium").directive("billboard",["BillBoardAttributes",function(e){return{restrict:"E",require:"^billboardsLayer",link:function(t,n,o,i){var r=e.calcAttributes(o,t),a=i.getBillboardCollection().add(r);t.$on("$destroy",function(){i.getBillboardCollection().remove(a)})}}}]),angular.module("angularCesium").directive("billboardsLayer",["$parse","ObservableCollection","BillBoardAttributes","Cesium",function(e,t,n,o){return{restrict:"E",require:"^map",controller:["$scope","$attrs",function(e,t){this.getBillboardCollection=function(){if(t.observableCollection)throw new Error("cannot get collection if layer is bound to ObservableCollection");return e.collection}}],link:{pre:function(i,r,a,l){if(i.collection=new o.BillboardCollection,a.observableCollection){var u=/\s*([\$\w][\$\w]*)\s+in\s+([\$\w][\$\w]*)/,s=a.observableCollection.match(u),c=s[1],m=e(s[2])(i);if(!m instanceof t)throw new Error("observable-collection must be of type ObservableCollection.");var d=function(e){var t={};t[c]=e;var o=n.calcAttributes(a,t);i.collection.add(o)};angular.forEach(m.getData(),function(e){d(e)}),m.onAdd(d),m.onUpdate(function(){}),m.onRemove(function(e,t){i.collection.remove(i.collection.get(t))})}l.getCesiumWidget().scene.primitives.add(i.collection),i.$on("$destroy",function(){l.getCesiumWidget().scene.primitives.remove(i.collection)})}}}}]),angular.module("angularCesium").directive("complexLayer",["$log",function(e){return{restrict:"E",require:"^map",compile:function(t,n){n.observableCollection&&angular.forEach(t.children(),function(n){var o=void 0;"BILLBOARD"===n.tagName?o=angular.element("<billboards-layer></billboards-layer>"):"LABEL"===n.tagName&&(o=angular.element("<labels-layer></labels-layer>")),o?(angular.forEach(n.attributes,function(e){o.attr(e.name,e.value)}),angular.forEach(t[0].attributes,function(e){angular.element(n).attr(e.name)||o.attr(e.name,e.value)}),angular.element(n).replaceWith(o)):(e.warn("Found an unknown child of of complex-layer. Removing..."),angular.element(n).remove())})}}}]),angular.module("angularCesium").directive("label",function(){return{restrict:"E",require:"^labelsLayer",scope:{color:"&",text:"&",position:"&"},link:function(e,t,n,o){var i={},r=e.position();i.position=Cesium.Cartesian3.fromDegrees(Number(r.latitude)||0,Number(r.longitude)||0,Number(r.altitude)||0);var a=e.color();a&&(i.color=a),i.text=e.text();var l=o.getLabelCollection().add(i);e.$on("$destroy",function(){o.getLabelCollection().remove(l)})}}}),angular.module("angularCesium").directive("labelsLayer",function(){return{restrict:"E",require:"^map",scope:{},controller:["$scope",function(e){this.getLabelCollection=function(){return e.collection}}],link:{pre:function(e,t,n,o){e.collection=new Cesium.LabelCollection,o.getCesiumWidget().scene.primitives.add(e.collection),e.$on("$destroy",function(){o.getCesiumWidget().scene.primitives.remove(e.collection)})}}}}),angular.module("angularCesium").directive("map",function(){function e(e){return 2==e?Cesium.SceneMode.SCENE2D:2.5==e?Cesium.SceneMode.COLUMBUS_VIEW:Cesium.SceneMode.SCENE3D}return{restrict:"E",template:'<div> <ng-transclude></ng-transclude> <div class="map-container"></div> </div>',transclude:!0,scope:{dimensions:"@"},controller:["$scope",function(e){this.getCesiumWidget=function(){return e.cesium},e.onDrop=function(){}}],link:{pre:function(t,n){t.dimensions||(t.dimensions=3),t.cesium=new Cesium.CesiumWidget(n.find("div")[0],{sceneMode:e(t.dimensions)}),t.mapRect=n[0].getBoundingClientRect()}}}}),angular.module("angularCesium").directive("polyline",function(){return{restrict:"E",require:"^polylinesLayer",scope:{color:"&",width:"&",positions:"&"},link:function(e,t,n,o){var i={};if(!angular.isDefined(e.positions)||!angular.isFunction(e.positions))throw"Polyline positions must be defined as a function";var r=e.positions();i.positions=[],angular.forEach(r,function(e){i.positions.push(Cesium.Cartesian3.fromDegrees(Number(e.latitude)||0,Number(e.longitude)||0,Number(e.altitude)||0))});var a=Cesium.Color.fromCssColorString("black");angular.isDefined(e.color)&&angular.isFunction(e.color)&&(a=Cesium.Color.fromCssColorString(e.color())),i.material=Cesium.Material.fromType("Color"),i.material.uniforms.color=a,i.width=1,angular.isDefined(e.width)&&angular.isFunction(e.width)&&(i.width=e.width());var l=o.getPolylineCollection().add(i);e.$on("$destroy",function(){o.getPolylineCollection().remove(l)})}}}),angular.module("angularCesium").directive("polylinesLayer",function(){return{restrict:"E",require:"^map",scope:{},controller:["$scope",function(e){this.getPolylineCollection=function(){return e.collection}}],link:{pre:function(e,t,n,o){e.collection=new Cesium.PolylineCollection,o.getCesiumWidget().scene.primitives.add(e.collection),e.$on("$destroy",function(){o.getCesiumWidget().scene.primitives.remove(e.collection)})}}}}),function(e){e.module("angularCesium").directive("toolBar",[function(){return{require:"^map",controller:["$scope",function(e){var t=null;this.getCesiumWidget=function(){return e.getCesiumWidget()},this.startTool=function(e){null!==t&&t.stop(),t=e,t.start()}}],link:{pre:function(e,t,n,o){e.getCesiumWidget=o.getCesiumWidget}}}}])}(window.angular),function(e){e.module("angularCesium").directive("tool",["Tool","Proxy",function(e,t){return{replace:!0,require:"^toolbar",transclude:"element",scope:{type:"="},controller:["$scope",function(e){this.getTool=function(){return e.tool}}],link:function(n,o,i,r,a){if("function"!=typeof n.type)throw new TypeError("type attr must be constructor.");var l=new n.type(r.getCesiumWidget());if(!(l instanceof e))throw new TypeError("tool must be instance of Tool.");l.start=t(l.start,{apply:function(e){return r.startTool({start:function(){return e.apply(l)},stop:function(){return l.stop()}})}}),n.tool=l,a(n,function(e){o.parent().append(e)})}}}])}(window.angular),angular.module("angularCesium").directive("draggable",["$document",function(e){return function(t,n){function o(e){s=e.pageY-l,u=e.pageX-a,r()?(c=u,m=s):v.css({top:m+"px",left:c+"px"})}function i(){n.css({cursor:"-webkit-grab"}),e.off("mousemove",o),e.off("mouseup",i)}function r(){return v.css({top:s+"px",left:u+"px"}),b=v[0].getBoundingClientRect(),b.top<g.top||b.left<g.left||b.right>g.right||b.bottom>g.bottom?!1:!0}var a=0,l=0,u=0,s=0,c=0,m=0,d=-1,p=-1,f=t.$parent.mapRect,g={},b={},v=n.parent();n.on("mousedown",function(t){t.preventDefault(),-1==d?(d=v[0].offsetTop,p=v[0].offsetLeft,g.top=d+f.top,g.left=p+f.left,g.right=p+f.right-5,g.bottom=d+f.bottom-15,b=v[0].getBoundingClientRect(),console.log("draggable2",g)):(d=0,p=0),a=t.pageX-u-p,l=t.pageY-s-d,n.css({cursor:"-webkit-grabbing"}),e.on("mousemove",o),e.on("mouseup",i)})}}]),angular.module("angularCesium").directive("toolbar",function(){return{restrict:"E",template:'<div class="toolbar" ><div class="drag-button glyphicon glyphicon-minus" draggable></div> <ng-transclude></ng-transclude></div>',transclude:!0,require:"^map",controller:["$scope",function(e){var t=null;this.getCesiumWidget=function(){return e.getCesiumWidget()},this.startTool=function(e){null!==t&&t.stop(),t=e,t.start()}}],link:{pre:function(e,t,n,o){e.getCesiumWidget=o.getCesiumWidget}}}}),angular.module("angularCesium").directive("webMapServiceLayer",function(){return{restrict:"E",require:"^map",scope:{url:"&",layers:"&"},controller:["$scope",function(){}],link:function(e,t,n,o){var i=new Cesium.WebMapServiceImageryProvider({url:e.url(),layers:e.layers()}),r=o.getCesiumWidget().scene.imageryLayers.addImageryProvider(i);e.$on("$destroy",function(){o.getCesiumWidget().scene.imageryLayers.remove(r)})}}}),function(e){e.module("angularCesium").factory("ZoomTool",["Tool",function(e){var t=Symbol("_camera"),n=Symbol("_ellipsoid"),o=function(e){this[t]=e.scene.camera,this[n]=e.scene.globe.ellipsoid};return $traceurRuntime.createClass(o,{start:function(){return!0},stop:function(){return!0},zoomIn:function(e){e=Number.isFinite(e)?e:1;for(var o=0;e>o;o++){var i=this[n].cartesianToCartographic(this[t].position).height,r=i/100;this[t].moveForward(r)}},zoomOut:function(e){e=Number.isFinite(e)?e:1;for(var o=0;e>o;o++){var i=this[n].cartesianToCartographic(this[t].position).height,r=i/100;this[t].moveBackward(r)}}},{},e),o}])}(window.angular),function(e){e.module("angularCesium").directive("zoomWidget",["$document",function(t){return{replace:!0,require:"^tool",template:'<div class="zoom-widget"><div class="zoom-in-btn"><button type="button" class="btn btn-default" ng-click="zoomIn();"><span class="glyphicon glyphicon-zoom-in" aria-hidden="true"></span></button></div><div class="slider"><span class="bar"></span><span class="pointer"></span></div><div class="zoom-out-btn"><button type="button" class="btn btn-default" ng-click="zoomOut();"><span class="glyphicon glyphicon-zoom-out" aria-hidden="true"></span></button></div></div>',link:function(n,o,i,r){if(isFinite(i.width)||isFinite(i.height)){var a=isFinite(i.width)?Number.parseInt(i.width)+"px":"inherit",l=isFinite(i.height)?Number.parseInt(i.height)+"px":"inherit";o.css({position:"relative",width:a,height:l})}var u=isFinite(i.min)?Number.parseInt(i.min):0,s=isFinite(i.max)?Number.parseInt(i.max):100;if(0>u||0>s||u>=s)throw new Error("min or max attributes value are invalid.");var c=isFinite(i.jump)?Number.parseInt(i.jump):10,m=r.getTool();if("function"!=typeof m.zoomIn||"function"!=typeof m.zoomOut)throw new TypeError("Zoom widget must be inside tool with ZoomTool type.");var d=90/(s-u),p=(s-u)/2,f=(s+u)/2,g=f,b=45,v=e.element(o.find("span")[2]);v.css("top",p*d+"%");var h=null,C=10*v[0].clientHeight,y=b;v.on("mousedown",function(e){e.preventDefault(),h=e.clientY,y=b,g=f,v.addClass("active")}),t.on("mouseup",function(){null!==h&&(h=null,v.removeClass("active"))}),t.on("mousemove",function(e){if(null!==h){var t=h-e.clientY,n=100*Math.abs(t)/C;b=t>0?y-n>=0?y-n:0:90>=y+n?y+n:90,p=Math.trunc(b/d),f=s-p,f>g&&m.zoomIn((f-g)*c),g>f&&m.zoomOut((g-f)*c),g=f,v.css("top",p*d+"%")}}),n.zoomIn=function(){s>f&&(f++,p--,b=p*d,v.css("top",b+"%"),m.zoomIn(c))},n.zoomOut=function(){f>u&&(f--,p++,b=p*d,v.css("top",b+"%"),m.zoomOut(c))}}}}])}(window.angular),function(e){e.module("angularCesium").factory("ZoomAreaTool",["Tool","Cesium",function(t,n){var o,i=Symbol("_map"),r=Symbol("_ensureFly"),a=Symbol("_initMapMouseHandlers"),l=Symbol("_removeMapMouseHandlers"),u=Symbol("_initCesiumMouseHandlers"),s=Symbol("_removeCesiumMouseHandlers"),c=function(e){this[i]=e,this[r]=!1};return $traceurRuntime.createClass(c,(o={},Object.defineProperty(o,a,{value:function(){var t=this,n=0,o=0,a=0,l=0,u=0,s=0,c=!1,m=e.element("<div></div>"),d=e.element(this[i].canvas.parentNode);m.css("border","2px dashed white"),d.on("mousedown",function(e){n=e.pageX,o=e.pageY,a=e.offsetX,l=e.offsetY,t[r]=!1,d.css("cursor","zoom-in"),m.css({position:"absolute",top:l+"px",left:a+"px",width:"0px",height:"0px"}),d.append(m),c=!0}),d.on("mousemove",function(e){if(c){u=e.pageX-n,s=e.pageY-o;var t={};u>0&&(t.width=u+"px"),0>u&&(u=Math.abs(u),t.width=u+"px",t.left=a-u+"px"),s>0&&(t.height=s+"px"),0>s&&(s=Math.abs(s),t.height=s+"px",t.top=l-s+"px"),m.css(t)}}),d.on("mouseup",function(){c=!1,m.remove(),d.css("cursor",""),t[r]=!0}),d.on("mouseleave",function(){c=!1,d.css("cursor",""),m.remove()})},configurable:!0,enumerable:!0,writable:!0}),Object.defineProperty(o,l,{value:function(){var t=e.element(this[i].canvas.parentNode);t.unbind("mousedown"),t.unbind("mousemove"),t.unbind("mouseup"),t.unbind("mouseleave")},configurable:!0,enumerable:!0,writable:!0}),Object.defineProperty(o,u,{value:function(){var e=this,t=null,o=null,a=this[i].scene.camera,l=this[i].scene.globe.ellipsoid,u=new n.ScreenSpaceEventHandler(this[i].canvas);u.setInputAction(function(e){var o=a.pickEllipsoid(e.position);if(o){var i=l.cartesianToCartographic(o);t={lon:n.Math.toDegrees(i.longitude),lat:n.Math.toDegrees(i.latitude)}}else t=null},n.ScreenSpaceEventType.LEFT_DOWN),u.setInputAction(function(i){var u=a.pickEllipsoid(i.position);if(u){var s=l.cartesianToCartographic(u);o={lon:n.Math.toDegrees(s.longitude),lat:n.Math.toDegrees(s.latitude)}}else o=null;if(e[r]&&null!==t&&null!=o){e[r]=!1;var c=n.Rectangle.fromDegrees(t.lon,t.lat,o.lon,o.lat);a.flyToRectangle({destination:c})}},n.ScreenSpaceEventType.LEFT_UP)},configurable:!0,enumerable:!0,writable:!0}),Object.defineProperty(o,s,{value:function(){var e=new n.ScreenSpaceEventHandler(this[i].canvas);e.removeInputAction(n.ScreenSpaceEventType.LEFT_DOWN),e.removeInputAction(n.ScreenSpaceEventType.LEFT_UP)},configurable:!0,enumerable:!0,writable:!0}),Object.defineProperty(o,"start",{value:function(){this[i].scene.screenSpaceCameraController.enableRotate=!1,this[r]=!1,this[u](),this[a]()},configurable:!0,enumerable:!0,writable:!0}),Object.defineProperty(o,"stop",{value:function(){this[i].scene.screenSpaceCameraController.enableRotate=!0,this[s](),this[l]()},configurable:!0,enumerable:!0,writable:!0}),o),{},t),c}])}(window.angular);