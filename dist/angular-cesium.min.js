"use strict";angular.module("angularCesium",["observableCollection"]),angular.module("angularCesium").service("BillBoardAttributes",["$parse",function(e){this.calcAttributes=function(t,n){var o={image:e(t.image)(n)},i=e(t.position)(n);o.position=Cesium.Cartesian3.fromDegrees(Number(i.latitude)||0,Number(i.longitude)||0,Number(i.altitude)||0);var r=e(t.color)(n);return r&&(o.color=Cesium.Color.fromCssColorString(r)),o}}]),angular.module("angularCesium").factory("Cesium",function(){return Cesium}),function(e){e.module("angularCesium").factory("Proxy",[function(){function e(e,t){if("object"!=typeof e&&"function"!=typeof e)throw new TypeError("Target must be object or function.");if(void 0!==t){if("object"!=typeof t)throw new TypeError("Handler mut be object");if("function"==typeof e){if("function"!=typeof t.apply)return;return function(){for(var n=[],o=0;o<arguments.length;o++)n[o]=arguments[o];return t.apply(e,this,n)}}if("function"==typeof t.get||"function"==typeof t.set){var n=this,o=function(o){var i={};void 0!==t.get&&(i.get=function(){return t.get(e,o)}),void 0!==t.set&&(i.set=function(n){t.set(e,o,n)}),Object.defineProperty(n,o,i)};for(var i in e)o(i)}}}return e}])}(window.angular),function(e){e.module("angularCesium").factory("Tool",[function(){var e=function(e){this._map=e};return $traceurRuntime.createClass(e,{start:function(){throw"No implementation"},stop:function(){throw"No implementation"},cancel:function(){throw"No implementation"},onUpdate:function(){throw"No implementation"}},{}),e}])}(window.angular),angular.module("angularCesium").directive("billboard",["BillBoardAttributes",function(e){return{restrict:"E",require:"^billboardsLayer",link:function(t,n,o,i){var r=e.calcAttributes(o,t),a=i.getBillboardCollection().add(r);t.$on("$destroy",function(){i.getBillboardCollection().remove(a)})}}}]),angular.module("angularCesium").directive("label",function(){return{restrict:"E",require:"^labelsLayer",scope:{color:"&",text:"&",position:"&"},link:function(e,t,n,o){var i={},r=e.position();i.position=Cesium.Cartesian3.fromDegrees(Number(r.latitude)||0,Number(r.longitude)||0,Number(r.altitude)||0);var a=e.color();a&&(i.color=a),i.text=e.text();var l=o.getLabelCollection().add(i);e.$on("$destroy",function(){o.getLabelCollection().remove(l)})}}}),angular.module("angularCesium").directive("labelsLayer",function(){return{restrict:"E",require:"^map",scope:{},controller:["$scope",function(e){this.getLabelCollection=function(){return e.collection}}],link:{pre:function(e,t,n,o){e.collection=new Cesium.LabelCollection,o.getCesiumWidget().scene.primitives.add(e.collection),e.$on("$destroy",function(){o.getCesiumWidget().scene.primitives.remove(e.collection)})}}}}),angular.module("angularCesium").directive("polyline",function(){return{restrict:"E",require:"^polylinesLayer",scope:{color:"&",width:"&",positions:"&"},link:function(e,t,n,o){var i={};if(!angular.isDefined(e.positions)||!angular.isFunction(e.positions))throw"Polyline positions must be defined as a function";var r=e.positions();i.positions=[],angular.forEach(r,function(e){i.positions.push(Cesium.Cartesian3.fromDegrees(Number(e.latitude)||0,Number(e.longitude)||0,Number(e.altitude)||0))});var a=Cesium.Color.fromCssColorString("black");angular.isDefined(e.color)&&angular.isFunction(e.color)&&(a=Cesium.Color.fromCssColorString(e.color())),i.material=Cesium.Material.fromType("Color"),i.material.uniforms.color=a,i.width=1,angular.isDefined(e.width)&&angular.isFunction(e.width)&&(i.width=e.width());var l=o.getPolylineCollection().add(i);e.$on("$destroy",function(){o.getPolylineCollection().remove(l)})}}}),angular.module("angularCesium").directive("complexLayer",["$log",function(e){return{restrict:"E",require:"^map",compile:function(t,n){n.observableCollection&&angular.forEach(t.children(),function(n){var o=void 0;"BILLBOARD"===n.tagName?o=angular.element("<billboards-layer></billboards-layer>"):"LABEL"===n.tagName&&(o=angular.element("<labels-layer></labels-layer>")),o?(angular.forEach(n.attributes,function(e){o.attr(e.name,e.value)}),angular.forEach(t[0].attributes,function(e){angular.element(n).attr(e.name)||o.attr(e.name,e.value)}),angular.element(n).replaceWith(o)):(e.warn("Found an unknown child of of complex-layer. Removing..."),angular.element(n).remove())})}}}]),angular.module("angularCesium").directive("billboardsLayer",["$parse","ObservableCollection","BillBoardAttributes","Cesium",function(e,t,n,o){return{restrict:"E",require:"^map",controller:["$scope","$attrs",function(e,t){this.getBillboardCollection=function(){if(t.observableCollection)throw new Error("cannot get collection if layer is bound to ObservableCollection");return e.collection}}],link:{pre:function(i,r,a,l){if(i.collection=new o.BillboardCollection,a.observableCollection){var u=/\s*([\$\w][\$\w]*)\s+in\s+([\$\w][\$\w]*)/,s=a.observableCollection.match(u),c=s[1],m=e(s[2])(i);if(!m instanceof t)throw new Error("observable-collection must be of type ObservableCollection.");var p=function(e){var t={};t[c]=e;var o=n.calcAttributes(a,t);i.collection.add(o)};angular.forEach(m.getData(),function(e){p(e)}),m.onAdd(p),m.onUpdate(function(){}),m.onRemove(function(e,t){i.collection.remove(i.collection.get(t))})}l.getCesiumWidget().scene.primitives.add(i.collection),i.$on("$destroy",function(){l.getCesiumWidget().scene.primitives.remove(i.collection)})}}}}]),angular.module("angularCesium").directive("map",function(){function e(e){return 2==e?Cesium.SceneMode.SCENE2D:2.5==e?Cesium.SceneMode.COLUMBUS_VIEW:Cesium.SceneMode.SCENE3D}return{restrict:"E",template:'<div> <ng-transclude></ng-transclude> <div class="map-container"></div> </div>',transclude:!0,scope:{dimensions:"@"},controller:["$scope",function(e){this.getCesiumWidget=function(){return e.cesium},e.onDrop=function(){}}],link:{pre:function(t,n){t.dimensions||(t.dimensions=3),t.cesium=new Cesium.CesiumWidget(n.find("div")[0],{sceneMode:e(t.dimensions)}),t.mapRect=n[0].getBoundingClientRect()}}}}),angular.module("angularCesium").directive("polylinesLayer",function(){return{restrict:"E",require:"^map",scope:{},controller:["$scope",function(e){this.getPolylineCollection=function(){return e.collection}}],link:{pre:function(e,t,n,o){e.collection=new Cesium.PolylineCollection,o.getCesiumWidget().scene.primitives.add(e.collection),e.$on("$destroy",function(){o.getCesiumWidget().scene.primitives.remove(e.collection)})}}}}),function(e){e.module("angularCesium").directive("toolBar",[function(){return{require:"^map",controller:["$scope",function(e){var t=null;this.getCesiumWidget=function(){return e.getCesiumWidget()},this.startTool=function(e){null!==t&&t.stop(),t=e,t.start()}}],link:{pre:function(e,t,n,o){e.getCesiumWidget=o.getCesiumWidget}}}}])}(window.angular),function(e){e.module("angularCesium").directive("tool",["Tool","Proxy",function(e,t){return{replace:!0,require:"^toolbar",transclude:"element",scope:{type:"="},controller:["$scope",function(e){this.getTool=function(){return e.tool}}],link:function(n,o,i,r,a){if("function"!=typeof n.type)throw new TypeError("type attr must be constructor.");var l=new n.type(r.getCesiumWidget());if(!(l instanceof e))throw new TypeError("tool must be instance of Tool.");l.start=t(l.start,{apply:function(e){return r.startTool({start:function(){return e.apply(l)},stop:function(){return l.stop()}})}}),n.tool=l,a(n,function(e){o.parent().append(e)})}}}])}(window.angular),angular.module("angularCesium").directive("webMapServiceLayer",function(){return{restrict:"E",require:"^map",scope:{url:"&",layers:"&"},controller:["$scope",function(){}],link:function(e,t,n,o){var i=new Cesium.WebMapServiceImageryProvider({url:e.url(),layers:e.layers()}),r=o.getCesiumWidget().scene.imageryLayers.addImageryProvider(i);e.$on("$destroy",function(){o.getCesiumWidget().scene.imageryLayers.remove(r)})}}}),angular.module("angularCesium").directive("draggable",["$document",function(e){return function(t,n){function o(e){s=e.pageY-l,u=e.pageX-a,r()?(c=u,m=s):h.css({top:m+"px",left:c+"px"})}function i(){n.css({cursor:"-webkit-grab"}),e.off("mousemove",o),e.off("mouseup",i)}function r(){return h.css({top:s+"px",left:u+"px"}),v=h[0].getBoundingClientRect(),v.top<g.top||v.left<g.left||v.right>g.right||v.bottom>g.bottom?!1:!0}var a=0,l=0,u=0,s=0,c=0,m=0,p=-1,d=-1,f=t.$parent.mapRect,g={},v={},h=n.parent();n.on("mousedown",function(t){t.preventDefault(),-1==p?(p=h[0].offsetTop,d=h[0].offsetLeft,g.top=p+f.top,g.left=d+f.left,g.right=d+f.right-5,g.bottom=p+f.bottom-15,v=h[0].getBoundingClientRect(),console.log("draggable2",g)):(p=0,d=0),a=t.pageX-u-d,l=t.pageY-s-p,n.css({cursor:"-webkit-grabbing"}),e.on("mousemove",o),e.on("mouseup",i)})}}]),angular.module("angularCesium").directive("toolbar",function(){return{restrict:"E",template:'<div class="toolbar" ><div class="drag-button glyphicon glyphicon-minus" draggable></div> <ng-transclude></ng-transclude></div>',transclude:!0,require:"^map",controller:["$scope",function(e){var t=null;this.getCesiumWidget=function(){return e.getCesiumWidget()},this.startTool=function(e){null!==t&&t.stop(),t=e,t.start()}}],link:{pre:function(e,t,n,o){e.getCesiumWidget=o.getCesiumWidget}}}}),function(e){e.module("angularCesium").factory("ZoomAreaTool",["Tool","Cesium",function(t,n){var o=function(){$traceurRuntime.superConstructor(i).apply(this,arguments)},i=o;return $traceurRuntime.createClass(o,{_initMapMouseHandlers:function(){var t=this,n=0,o=0,i=0,r=0,a=0,l=0,u=!1,s=e.element("<div></div>"),c=e.element(this._map.canvas.parentNode);s.css("border","2px dashed white"),c.on("mousedown",function(e){n=e.pageX,o=e.pageY,i=e.offsetX,r=e.offsetY,t._enshureFly=!1,c.css("cursor","zoom-in"),s.css({position:"absolute",top:r+"px",left:i+"px",width:"0px",height:"0px"}),c.append(s),u=!0}),c.on("mousemove",function(e){if(u){a=e.pageX-n,l=e.pageY-o;var t={};a>0&&(t.width=a+"px"),0>a&&(a=Math.abs(a),t.width=a+"px",t.left=i-a+"px"),l>0&&(t.height=l+"px"),0>l&&(l=Math.abs(l),t.height=l+"px",t.top=r-l+"px"),s.css(t)}}),c.on("mouseup",function(){u=!1,s.remove(),c.css("cursor",""),t._enshureFly=!0}),c.on("mouseleave",function(){u=!1,c.css("cursor",""),s.remove()})},_removeMapMouseHandlers:function(){var t=e.element(this._map.canvas.parentNode);t.unbind("mousedown"),t.unbind("mousemove"),t.unbind("mouseup"),t.unbind("mouseleave")},_initCesiumMouseHandlers:function(){var e=this,t=null,o=null,i=this._map.scene.camera,r=this._map.scene.globe.ellipsoid,a=new n.ScreenSpaceEventHandler(this._map.canvas);a.setInputAction(function(e){var o=i.pickEllipsoid(e.position);if(o){var a=r.cartesianToCartographic(o);t={lon:n.Math.toDegrees(a.longitude),lat:n.Math.toDegrees(a.latitude)}}else t=null},n.ScreenSpaceEventType.LEFT_DOWN),a.setInputAction(function(a){var l=i.pickEllipsoid(a.position);if(l){var u=r.cartesianToCartographic(l);o={lon:n.Math.toDegrees(u.longitude),lat:n.Math.toDegrees(u.latitude)}}else o=null;if(e._enshureFly&&null!==t&&null!=o){e._enshureFly=!1;var s=n.Rectangle.fromDegrees(t.lon,t.lat,o.lon,o.lat);i.flyToRectangle({destination:s})}},n.ScreenSpaceEventType.LEFT_UP)},_removeCesiumMouseHandlers:function(){var e=new n.ScreenSpaceEventHandler(this._map.canvas);e.removeInputAction(n.ScreenSpaceEventType.LEFT_DOWN),e.removeInputAction(n.ScreenSpaceEventType.LEFT_UP)},start:function(){this._map.scene.screenSpaceCameraController.enableRotate=!1,this._enshureFly=!1,this._initCesiumMouseHandlers(),this._initMapMouseHandlers()},stop:function(){this._map.scene.screenSpaceCameraController.enableRotate=!0,this._removeCesiumMouseHandlers(),this._removeMapMouseHandlers()}},{},t),o}])}(window.angular),function(e){e.module("angularCesium").factory("ZoomTool",["Tool",function(e){var t=function(e){this._camera=e.scene.camera,this._ellipsoid=e.scene.globe.ellipsoid};return $traceurRuntime.createClass(t,{start:function(){return!0},stop:function(){return!0},zoomIn:function(e){e=Number.isFinite(e)?e:1;for(var t=0;e>t;t++){var n=this._ellipsoid.cartesianToCartographic(this._camera.position).height,o=n/100;this._camera.moveForward(o)}},zoomOut:function(e){e=Number.isFinite(e)?e:1;for(var t=0;e>t;t++){var n=this._ellipsoid.cartesianToCartographic(this._camera.position).height,o=n/100;this._camera.moveBackward(o)}}},{},e),t}])}(window.angular),function(e){e.module("angularCesium").directive("zoomWidget",["$document",function(t){return{replace:!0,require:"^tool",template:'<div class="zoom-widget"><div class="zoom-in-btn"><button type="button" class="btn btn-default" ng-click="zoomIn();"><span class="glyphicon glyphicon-zoom-in" aria-hidden="true"></span></button></div><div class="slider"><span class="bar"></span><span class="pointer"></span></div><div class="zoom-out-btn"><button type="button" class="btn btn-default" ng-click="zoomOut();"><span class="glyphicon glyphicon-zoom-out" aria-hidden="true"></span></button></div></div>',link:function(n,o,i,r){if(isFinite(i.width)||isFinite(i.height)){var a=isFinite(i.width)?Number.parseInt(i.width)+"px":"inherit",l=isFinite(i.height)?Number.parseInt(i.height)+"px":"inherit";o.css({position:"relative",width:a,height:l})}var u=isFinite(i.min)?Number.parseInt(i.min):0,s=isFinite(i.max)?Number.parseInt(i.max):100;if(0>u||0>s||u>=s)throw new Error("min or max attributes value are invalid.");var c=isFinite(i.jump)?Number.parseInt(i.jump):10,m=r.getTool();if("function"!=typeof m.zoomIn||"function"!=typeof m.zoomOut)throw new TypeError("Zoom widget must be inside tool with ZoomTool type.");var p=90/(s-u),d=(s-u)/2,f=(s+u)/2,g=f,v=45,h=e.element(o.find("span")[2]);h.css("top",d*p+"%");var b=null,C=10*h[0].clientHeight,y=v;h.on("mousedown",function(e){e.preventDefault(),b=e.clientY,y=v,g=f,h.addClass("active")}),t.on("mouseup",function(){null!==b&&(b=null,h.removeClass("active"))}),t.on("mousemove",function(e){if(null!==b){var t=b-e.clientY,n=100*Math.abs(t)/C;v=t>0?y-n>=0?y-n:0:90>=y+n?y+n:90,d=Math.trunc(v/p),f=s-d,f>g&&m.zoomIn((f-g)*c),g>f&&m.zoomOut((g-f)*c),g=f,h.css("top",d*p+"%")}}),n.zoomIn=function(){s>f&&(f++,d--,v=d*p,h.css("top",v+"%"),m.zoomIn(c))},n.zoomOut=function(){f>u&&(f--,d++,v=d*p,h.css("top",v+"%"),m.zoomOut(c))}}}}])}(window.angular);