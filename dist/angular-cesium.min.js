"use strict";angular.module("angularCesium",["observableCollection"]),angular.module("angularCesium").service("BillBoardAttributes",["$parse",function(e){this.calcAttributes=function(t,n){var o={image:e(t.image)(n)},i=e(t.position)(n);o.position=Cesium.Cartesian3.fromDegrees(Number(i.latitude)||0,Number(i.longitude)||0,Number(i.altitude)||0);var r=e(t.color)(n);return r&&(o.color=Cesium.Color.fromCssColorString(r)),o}}]),angular.module("angularCesium").factory("Cesium",function(){return Cesium}),function(e){e.module("angularCesium").factory("Proxy",[function(){function e(e,t){if(null===e||"object"!=typeof e&&"function"!=typeof e)throw new TypeError("Target must be object or function.");if(void 0!==t){if(null===t||"object"!=typeof t)throw new TypeError("Handler mut be object");if("function"==typeof e){if("function"!=typeof t.apply)return;return function(){for(var n=[],o=0;o<arguments.length;o++)n[o]=arguments[o];return t.apply(e,this,n)}}if("function"==typeof t.get||"function"==typeof t.set){var n=this,o=function(o){var i={};void 0!==t.get&&(i.get=function(){return t.get(e,o)}),void 0!==t.set&&(i.set=function(n){t.set(e,o,n)}),Object.defineProperty(n,o,i)};for(var i in e)o(i)}}}return e}])}(window.angular),function(e){e.module("angularCesium").factory("Tool",[function(){var e=function(){};return $traceurRuntime.createClass(e,{start:function(){throw"No implementation"},stop:function(){throw"No implementation"},cancel:function(){throw"No implementation"},onUpdate:function(){throw"No implementation"}},{}),e}])}(window.angular),angular.module("angularCesium").directive("billboard",["BillBoardAttributes",function(e){return{restrict:"E",require:"^billboardsLayer",link:function(t,n,o,i){var r=e.calcAttributes(o,t),a=i.getBillboardCollection().add(r);t.$on("$destroy",function(){i.getBillboardCollection().remove(a)})}}}]),angular.module("angularCesium").directive("billboardsLayer",["$parse","ObservableCollection","BillBoardAttributes","Cesium",function(e,t,n,o){return{restrict:"E",require:"^map",controller:["$scope","$attrs",function(e,t){this.getBillboardCollection=function(){if(t.observableCollection)throw new Error("cannot get collection if layer is bound to ObservableCollection");return e.collection}}],link:{pre:function(i,r,a,l){if(i.collection=new o.BillboardCollection,a.observableCollection){var u=/\s*([\$\w][\$\w]*)\s+in\s+([\$\w][\$\w]*)/,s=a.observableCollection.match(u),c=s[1],m=e(s[2])(i);if(!m instanceof t)throw new Error("observable-collection must be of type ObservableCollection.");var f=function(e){var t={};t[c]=e;var o=n.calcAttributes(a,t);i.collection.add(o)};angular.forEach(m.getData(),function(e){f(e)}),m.onAdd(f),m.onUpdate(function(){}),m.onRemove(function(e,t){i.collection.remove(i.collection.get(t))})}l.getCesiumWidget().scene.primitives.add(i.collection),i.$on("$destroy",function(){l.getCesiumWidget().scene.primitives.remove(i.collection)})}}}}]),angular.module("angularCesium").directive("complexLayer",["$log",function(e){return{restrict:"E",require:"^map",compile:function(t,n){n.observableCollection&&angular.forEach(t.children(),function(n){var o=void 0;"BILLBOARD"===n.tagName?o=angular.element("<billboards-layer></billboards-layer>"):"LABEL"===n.tagName&&(o=angular.element("<labels-layer></labels-layer>")),o?(angular.forEach(n.attributes,function(e){o.attr(e.name,e.value)}),angular.forEach(t[0].attributes,function(e){angular.element(n).attr(e.name)||o.attr(e.name,e.value)}),angular.element(n).replaceWith(o)):(e.warn("Found an unknown child of of complex-layer. Removing..."),angular.element(n).remove())})}}}]),angular.module("angularCesium").directive("labelsLayer",function(){return{restrict:"E",require:"^map",scope:{},controller:["$scope",function(e){this.getLabelCollection=function(){return e.collection}}],link:{pre:function(e,t,n,o){e.collection=new Cesium.LabelCollection,o.getCesiumWidget().scene.primitives.add(e.collection),e.$on("$destroy",function(){o.getCesiumWidget().scene.primitives.remove(e.collection)})}}}}),angular.module("angularCesium").directive("label",function(){return{restrict:"E",require:"^labelsLayer",scope:{color:"&",text:"&",position:"&"},link:function(e,t,n,o){var i={},r=e.position();i.position=Cesium.Cartesian3.fromDegrees(Number(r.latitude)||0,Number(r.longitude)||0,Number(r.altitude)||0);var a=e.color();a&&(i.color=a),i.text=e.text();var l=o.getLabelCollection().add(i);e.$on("$destroy",function(){o.getLabelCollection().remove(l)})}}}),angular.module("angularCesium").directive("map",function(){function e(e){return 2==e?Cesium.SceneMode.SCENE2D:2.5==e?Cesium.SceneMode.COLUMBUS_VIEW:Cesium.SceneMode.SCENE3D}return{restrict:"E",template:'<div> <ng-transclude></ng-transclude> <div class="map-container"></div> </div>',transclude:!0,scope:{dimensions:"@"},controller:["$scope",function(e){this.getCesiumWidget=function(){return e.cesium},e.onDrop=function(){}}],link:{pre:function(t,n){t.dimensions||(t.dimensions=3),t.cesium=new Cesium.CesiumWidget(n.find("div")[0],{sceneMode:e(t.dimensions)}),t.mapRect=n[0].getBoundingClientRect()}}}}),angular.module("angularCesium").directive("polyline",function(){return{restrict:"E",require:"^polylinesLayer",scope:{color:"&",width:"&",positions:"&"},link:function(e,t,n,o){var i={};if(!angular.isDefined(e.positions)||!angular.isFunction(e.positions))throw"Polyline positions must be defined as a function";var r=e.positions();i.positions=[],angular.forEach(r,function(e){i.positions.push(Cesium.Cartesian3.fromDegrees(Number(e.latitude)||0,Number(e.longitude)||0,Number(e.altitude)||0))});var a=Cesium.Color.fromCssColorString("black");angular.isDefined(e.color)&&angular.isFunction(e.color)&&(a=Cesium.Color.fromCssColorString(e.color())),i.material=Cesium.Material.fromType("Color"),i.material.uniforms.color=a,i.width=1,angular.isDefined(e.width)&&angular.isFunction(e.width)&&(i.width=e.width());var l=o.getPolylineCollection().add(i);e.$on("$destroy",function(){o.getPolylineCollection().remove(l)})}}}),angular.module("angularCesium").directive("polylinesLayer",function(){return{restrict:"E",require:"^map",scope:{},controller:["$scope",function(e){this.getPolylineCollection=function(){return e.collection}}],link:{pre:function(e,t,n,o){e.collection=new Cesium.PolylineCollection,o.getCesiumWidget().scene.primitives.add(e.collection),e.$on("$destroy",function(){o.getCesiumWidget().scene.primitives.remove(e.collection)})}}}}),function(e){e.module("angularCesium").directive("toolBar",[function(){return{require:"^^map",controller:function(){var e=null;this.startTool=function(t){null!==e&&e.stop(),e=t,e.start()}}}}])}(window.angular),function(e){e.module("angularCesium").directive("tool",["Tool","Proxy",function(e,t){return{require:["^^map","^^toolbar"],transclude:!0,template:'<div ng-class="class"></div>',scope:{type:"=","class":"@"},controller:["$scope",function(e){this.getTool=function(){return e.tool}}],link:function(n,o,i,r,a){if("function"!=typeof n.type)throw new TypeError("type attr must be constructor.");var l=new n.type(r[0].getCesiumWidget());if(!(l instanceof e))throw new TypeError("tool must be instance of Tool.");l.start=t(l.start,{apply:function(e){return r[1].startTool({start:function(){return e.apply(l)},stop:function(){return l.stop()}})}}),n.tool=l,a(n,function(e){return o.children().append(e)})}}}])}(window.angular),angular.module("angularCesium").directive("draggable",["$document",function(e){return function(t,n){function o(e){s=e.pageY-l,u=e.pageX-a,r()?(c=u,m=s):h.css({top:m+"px",left:c+"px"})}function i(){n.css({cursor:"-webkit-grab"}),e.off("mousemove",o),e.off("mouseup",i)}function r(){return h.css({top:s+"px",left:u+"px"}),b=h[0].getBoundingClientRect(),b.top<g.top||b.left<g.left||b.right>g.right||b.bottom>g.bottom?!1:!0}var a=0,l=0,u=0,s=0,c=0,m=0,f=-1,d=-1,p=t.$parent.mapRect,g={},b={},h=n.parent();n.on("mousedown",function(t){t.preventDefault(),-1==f?(f=h[0].offsetTop,d=h[0].offsetLeft,g.top=f+p.top,g.left=d+p.left,g.right=d+p.right-5,g.bottom=f+p.bottom-15,b=h[0].getBoundingClientRect(),console.log("draggable2",g)):(f=0,d=0),a=t.pageX-u-d,l=t.pageY-s-f,n.css({cursor:"-webkit-grabbing"}),e.on("mousemove",o),e.on("mouseup",i)})}}]),angular.module("angularCesium").directive("toolbar",function(){return{restrict:"E",template:'<div class="toolbar" ><div class="drag-button glyphicon glyphicon-minus" draggable></div> <ng-transclude></ng-transclude></div>',transclude:!0,require:"^^map",controller:function(){var e=null;this.startTool=function(t){null!==e&&e.stop(),e=t,e.start()}}}}),angular.module("angularCesium").directive("webMapServiceLayer",function(){return{restrict:"E",require:"^map",scope:{url:"&",layers:"&"},controller:["$scope",function(){}],link:function(e,t,n,o){var i=new Cesium.WebMapServiceImageryProvider({url:e.url(),layers:e.layers()}),r=o.getCesiumWidget().scene.imageryLayers.addImageryProvider(i);e.$on("$destroy",function(){o.getCesiumWidget().scene.imageryLayers.remove(r)})}}}),function(e){e.module("angularCesium").factory("ZoomTool",["Tool",function(e){var t=Symbol("_camera"),n=Symbol("_ellipsoid"),o=function(e){this[t]=e.scene.camera,this[n]=e.scene.globe.ellipsoid};return $traceurRuntime.createClass(o,{start:function(){return!0},stop:function(){return!0},zoomIn:function(e){e=Number.isFinite(e)?e:1;for(var o=0;e>o;o++){var i=this[n].cartesianToCartographic(this[t].position).height,r=i/100;this[t].moveForward(r)}},zoomOut:function(e){e=Number.isFinite(e)?e:1;for(var o=0;e>o;o++){var i=this[n].cartesianToCartographic(this[t].position).height,r=i/100;this[t].moveBackward(r)}}},{},e),o}])}(window.angular),function(e){e.module("angularCesium").directive("zoomWidget",["$document",function(t){return{replace:!0,require:"^^tool",template:'<div class="zoom-widget"><div class="zoom-in-btn"><button type="button" class="btn btn-default" ng-click="zoomIn();"><span class="glyphicon glyphicon-zoom-in" aria-hidden="true"></span></button></div><div class="slider"><span class="bar"></span><span class="pointer"></span></div><div class="zoom-out-btn"><button type="button" class="btn btn-default" ng-click="zoomOut();"><span class="glyphicon glyphicon-zoom-out" aria-hidden="true"></span></button></div></div>',link:function(n,o,i,r){if(!Number.parseInt(i.width)||!Number.parseInt(i.height)){var a=Number.parseInt(i.width)?Number.parseInt(i.width)+"px":"inherit",l=Number.parseInt(i.height)?Number.parseInt(i.height)+"px":"inherit";o.css({position:"relative",width:a,height:l})}var u=Object.is(Number.parseInt(i.min),0/0)?0:Number.parseInt(i.min),s=Object.is(Number.parseInt(i.max),0/0)?100:Number.parseInt(i.max);if(0>u||0>s||u>=s)throw new Error("min or max attributes value are invalid.");var c=0;if(Object.is(c=Number.parseInt(i.start),0/0))c=Math.trunc((s+u)/2);else if(u>c||c>s)throw new Error("Invalid start attribute value.");var m=isFinite(i.jump)?Number.parseInt(i.jump):10,f=r.getTool();if("function"!=typeof f.zoomIn||"function"!=typeof f.zoomOut)throw new TypeError("Zoom widget must be inside tool with ZoomTool type.");var d=90/(s-u),p=s-u-(c-u),g=c,b=g,h=p*d,v=e.element(o.find("span")[2]);v.css("top",h+"%");var y=null,C=10*v[0].clientHeight,w=h;v.on("mousedown",function(e){e.preventDefault(),y=e.clientY,w=h,b=g,v.addClass("active")}),t.on("mouseup",function(){null!==y&&(y=null,v.removeClass("active"))}),t.on("mousemove",function(e){if(null!==y){var t=y-e.clientY,n=100*Math.abs(t)/C;h=t>0?w-n>=0?w-n:0:90>=w+n?w+n:90,p=Math.trunc(h/d),g=s-p,g>b&&f.zoomIn((g-b)*m),b>g&&f.zoomOut((b-g)*m),b=g,v.css("top",p*d+"%")}}),n.zoomIn=function(){s>g&&(g++,p--,h=p*d,v.css("top",h+"%"),f.zoomIn(m))},n.zoomOut=function(){g>u&&(g--,p++,h=p*d,v.css("top",h+"%"),f.zoomOut(m))}}}}])}(window.angular),function(e){e.module("angularCesium").factory("ZoomAreaTool",["Tool","Cesium",function(t,n){var o,i=Symbol("_map"),r=Symbol("_active"),a=Symbol("_ensureFly"),l=Symbol("_mapContainer"),u=Symbol("_mapEventsHandler"),s=Symbol("_mapContainerMouseDownHandler"),c=Symbol("_mapContainerMouseMoveHandler"),m=Symbol("_mapContainerMouseUpHandler"),f=Symbol("_mapContainerMouseLeave"),d=Symbol("_cesiumWidgetMouseDownHandler"),p=Symbol("_cesiumWidgetMouseUpHandler"),g=Symbol("_initMapContainerMouseHandlers"),b=Symbol("_bindMapContainerMouseHandlers"),h=Symbol("_unbindMapContainerMouseHandlers"),v=Symbol("_initCesiumWidgetMouseHandlers"),y=Symbol("_bindCesiumWidgetMouseHandlers"),C=Symbol("_unbindCesiumWidgetMouseHandlers"),w=function(t){this[i]=t,this[r]=!1,this[a]=!1,this[l]=e.element(t.canvas.parentNode),this[u]=new n.ScreenSpaceEventHandler(t.canvas),this[s]=null,this[c]=null,this[m]=null,this[f]=null,this[d]=null,this[p]=null,this[g](),this[v]()};return $traceurRuntime.createClass(w,(o={},Object.defineProperty(o,g,{value:function(){var t=this,n=0,o=0,i=0,u=0,d=0,p=0,g=!1,b=e.element("<div></div>");b.css("border","2px dashed white"),this[s]=function(e){t[r]&&(n=e.pageX,o=e.pageY,i=e.offsetX,u=e.offsetY,t[a]=!1,t[l].css("cursor","zoom-in"),b.css({position:"absolute",top:u+"px",left:i+"px",width:"0px",height:"0px"}),t[l].append(b),g=!0)},this[c]=function(e){if(t[r]&&g){d=e.pageX-n,p=e.pageY-o;var a={};d>0&&(a.width=d+"px"),0>d&&(d=Math.abs(d),a.width=d+"px",a.left=i-d+"px"),p>0&&(a.height=p+"px"),0>p&&(p=Math.abs(p),a.height=p+"px",a.top=u-p+"px"),b.css(a)}},this[m]=function(){t[r]&&(g=!1,b.remove(),t[l].css("cursor",""),t[a]=!0)},this[f]=function(){t[r]&&(g=!1,t[l].css("cursor",""),b.remove())}},configurable:!0,enumerable:!0,writable:!0}),Object.defineProperty(o,b,{value:function(){this[l].on("mousedown",this[s]),this[l].on("mousemove",this[c]),this[l].on("mouseup",this[m]),this[l].on("mouseleave",this[f])},configurable:!0,enumerable:!0,writable:!0}),Object.defineProperty(o,h,{value:function(){this[l].off("mousedown",this[s]),this[l].off("mousemove",this[c]),this[l].off("mouseup",this[m]),this[l].off("mouseleave",this[f])},configurable:!0,enumerable:!0,writable:!0}),Object.defineProperty(o,v,{value:function(){var e=this,t=null,o=null,l=this[i].scene.camera,u=this[i].scene.globe.ellipsoid;this[d]=function(o){if(e[r]){var i=l.pickEllipsoid(o.position);if(i){var a=u.cartesianToCartographic(i);t={lon:n.Math.toDegrees(a.longitude),lat:n.Math.toDegrees(a.latitude)}}else t=null}},this[p]=function(i){if(e[r]){var s=l.pickEllipsoid(i.position);if(s){var c=u.cartesianToCartographic(s);o={lon:n.Math.toDegrees(c.longitude),lat:n.Math.toDegrees(c.latitude)}}else o=null;if(e[a]&&null!==t&&null!=o){e[a]=!1;var m=n.Rectangle.fromDegrees(t.lon,t.lat,o.lon,o.lat);l.flyToRectangle({destination:m})}}}},configurable:!0,enumerable:!0,writable:!0}),Object.defineProperty(o,y,{value:function(){this[u].setInputAction(this[d],n.ScreenSpaceEventType.LEFT_DOWN),this[u].setInputAction(this[p],n.ScreenSpaceEventType.LEFT_UP)},configurable:!0,enumerable:!0,writable:!0}),Object.defineProperty(o,C,{value:function(){this[u].removeInputAction(n.ScreenSpaceEventType.LEFT_DOWN),this[u].removeInputAction(n.ScreenSpaceEventType.LEFT_UP)},configurable:!0,enumerable:!0,writable:!0}),Object.defineProperty(o,"start",{value:function(){this[i].scene.screenSpaceCameraController.enableRotate=!1,this[a]=!1,this[y](),this[b](),this[r]=!0},configurable:!0,enumerable:!0,writable:!0}),Object.defineProperty(o,"stop",{value:function(){this[r]=!1,this[i].scene.screenSpaceCameraController.enableRotate=!0,this[h](),this[C]()},configurable:!0,enumerable:!0,writable:!0}),Object.defineProperty(o,"toggle",{value:function(){this[r]?this.stop():this.start()},configurable:!0,enumerable:!0,writable:!0}),o),{},t),w}])}(window.angular);