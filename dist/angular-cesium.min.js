"use strict";angular.module("angularCesium",["observableCollection"]),angular.module("angularCesium").service("BillBoardAttributes",["$parse",function(e){this.calcAttributes=function(n,o){var t={image:e(n.image)(o)},i=e(n.position)(o);t.position=Cesium.Cartesian3.fromDegrees(Number(i.latitude)||0,Number(i.longitude)||0,Number(i.altitude)||0);var r=e(n.color)(o);return r&&(t.color=Cesium.Color.fromCssColorString(r)),t}}]),angular.module("angularCesium").factory("Cesium",function(){return Cesium}),function(e){e.module("angularCesium").factory("Tool",[function(){var e=function(e){this._map=e};return $traceurRuntime.createClass(e,{start:function(){throw"No implementation"},stop:function(){throw"No implementation"},cancel:function(){throw"No implementation"},onUpdate:function(){throw"No implementation"}},{}),e}])}(window.angular),angular.module("angularCesium").directive("billboard",["BillBoardAttributes",function(e){return{restrict:"E",require:"^billboardsLayer",link:function(n,o,t,i){var r=e.calcAttributes(t,n),l=i.getBillboardCollection().add(r);n.$on("$destroy",function(){i.getBillboardCollection().remove(l)})}}}]),angular.module("angularCesium").directive("billboardsLayer",["$parse","ObservableCollection","BillBoardAttributes","Cesium",function(e,n,o,t){return{restrict:"E",require:"^map",controller:["$scope","$attrs",function(e,n){this.getBillboardCollection=function(){if(n.observableCollection)throw new Error("cannot get collection if layer is bound to ObservableCollection");return e.collection}}],link:{pre:function(i,r,l,a){if(i.collection=new t.BillboardCollection,l.observableCollection){var u=/\s*([\$\w][\$\w]*)\s+in\s+([\$\w][\$\w]*)/,c=l.observableCollection.match(u),s=c[1],m=e(c[2])(i);if(!m instanceof n)throw new Error("observable-collection must be of type ObservableCollection.");var d=function(e){var n={};n[s]=e;var t=o.calcAttributes(l,n);i.collection.add(t)};angular.forEach(m.getData(),function(e){d(e)}),m.onAdd(d),m.onUpdate(function(){}),m.onRemove(function(e,n){i.collection.remove(i.collection.get(n))})}a.getCesiumWidget().scene.primitives.add(i.collection),i.$on("$destroy",function(){a.getCesiumWidget().scene.primitives.remove(i.collection)})}}}}]),angular.module("angularCesium").directive("complexLayer",["$log",function(e){return{restrict:"E",require:"^map",compile:function(n,o){o.observableCollection&&angular.forEach(n.children(),function(o){var t=void 0;"BILLBOARD"===o.tagName?t=angular.element("<billboards-layer></billboards-layer>"):"LABEL"===o.tagName&&(t=angular.element("<labels-layer></labels-layer>")),t?(angular.forEach(o.attributes,function(e){t.attr(e.name,e.value)}),angular.forEach(n[0].attributes,function(e){angular.element(o).attr(e.name)||t.attr(e.name,e.value)}),angular.element(o).replaceWith(t)):(e.warn("Found an unknown child of of complex-layer. Removing..."),angular.element(o).remove())})}}}]),angular.module("angularCesium").directive("labelsLayer",function(){return{restrict:"E",require:"^map",scope:{},controller:["$scope",function(e){this.getLabelCollection=function(){return e.collection}}],link:{pre:function(e,n,o,t){e.collection=new Cesium.LabelCollection,t.getCesiumWidget().scene.primitives.add(e.collection),e.$on("$destroy",function(){t.getCesiumWidget().scene.primitives.remove(e.collection)})}}}}),angular.module("angularCesium").directive("map",function(){function e(e){return 2==e?Cesium.SceneMode.SCENE2D:2.5==e?Cesium.SceneMode.COLUMBUS_VIEW:Cesium.SceneMode.SCENE3D}return{restrict:"E",template:'<div> <ng-transclude></ng-transclude> <div class="map-container"></div> </div>',transclude:!0,scope:{dimensions:"@"},controller:["$scope",function(e){this.getCesiumWidget=function(){return e.cesium}}],link:{pre:function(n,o){n.dimensions||(n.dimensions=3),n.cesium=new Cesium.CesiumWidget(o.find("div")[0],{sceneMode:e(n.dimensions)})}}}}),angular.module("angularCesium").directive("polyline",function(){return{restrict:"E",require:"^polylinesLayer",scope:{color:"&",width:"&",positions:"&"},link:function(e,n,o,t){var i={};if(!angular.isDefined(e.positions)||!angular.isFunction(e.positions))throw"Polyline positions must be defined as a function";var r=e.positions();i.positions=[],angular.forEach(r,function(e){i.positions.push(Cesium.Cartesian3.fromDegrees(Number(e.latitude)||0,Number(e.longitude)||0,Number(e.altitude)||0))});var l=Cesium.Color.fromCssColorString("black");angular.isDefined(e.color)&&angular.isFunction(e.color)&&(l=Cesium.Color.fromCssColorString(e.color())),i.material=Cesium.Material.fromType("Color"),i.material.uniforms.color=l,i.width=1,angular.isDefined(e.width)&&angular.isFunction(e.width)&&(i.width=e.width());var a=t.getPolylineCollection().add(i);e.$on("$destroy",function(){t.getPolylineCollection().remove(a)})}}}),angular.module("angularCesium").directive("label",function(){return{restrict:"E",require:"^labelsLayer",scope:{color:"&",text:"&",position:"&"},link:function(e,n,o,t){var i={},r=e.position();i.position=Cesium.Cartesian3.fromDegrees(Number(r.latitude)||0,Number(r.longitude)||0,Number(r.altitude)||0);var l=e.color();l&&(i.color=l),i.text=e.text();var a=t.getLabelCollection().add(i);e.$on("$destroy",function(){t.getLabelCollection().remove(a)})}}}),angular.module("angularCesium").directive("polylinesLayer",function(){return{restrict:"E",require:"^map",scope:{},controller:["$scope",function(e){this.getPolylineCollection=function(){return e.collection}}],link:{pre:function(e,n,o,t){e.collection=new Cesium.PolylineCollection,t.getCesiumWidget().scene.primitives.add(e.collection),e.$on("$destroy",function(){t.getCesiumWidget().scene.primitives.remove(e.collection)})}}}}),function(e){e.module("angularCesium").directive("toolBar",[function(){return{require:"^map",controller:["$scope",function(e){var n=null;this.getCesiumWidget=function(){return e.getCesiumWidget()},this.startTool=function(e){null!==n&&n.stop(),n=e,n.start()}}],link:{pre:function(e,n,o,t){e.getCesiumWidget=t.getCesiumWidget}}}}])}(window.angular),function(e){e.module("angularCesium").directive("tool",["Tool",function(e){return{replace:!0,require:"^toolBar",transclude:"element",scope:{type:"="},controller:["$scope",function(e){this.getTool=function(){return e.tool}}],compile:function(){return function(n,o,t,i,r){if("function"!=typeof n.type)throw new TypeError("type attr must be constructor.");var l=new n.type(i.getCesiumWidget());if(!(l instanceof e))throw new TypeError("tool must be instance of Tool.");var a,u={},c=function(e){return"start"===e?0:void Object.defineProperty(u,e,{get:function(){return l[e]},set:function(n){l[e]=n}})};e:for(var s in l)switch(a=c(s)){case 0:continue e}Object.defineProperty(u,"start",{get:function(){return function(){return i.startTool(l)}}}),n.tool=u,r(n,function(e){o.parent().append(e)})}}}}])}(window.angular),angular.module("angularCesium").directive("webMapServiceLayer",function(){return{restrict:"E",require:"^map",scope:{url:"&",layers:"&"},controller:["$scope",function(){}],link:function(e,n,o,t){var i=new Cesium.WebMapServiceImageryProvider({url:e.url(),layers:e.layers()}),r=t.getCesiumWidget().scene.imageryLayers.addImageryProvider(i);e.$on("$destroy",function(){t.getCesiumWidget().scene.imageryLayers.remove(r)})}}}),function(e){e.module("angularCesium").factory("ZoomTool",["Tool",function(e){var n=function(){$traceurRuntime.superConstructor(o).apply(this,arguments)},o=n;return $traceurRuntime.createClass(n,{start:function(){console.log("Examp-Tool start!")},stop:function(){console.log("Examp-Tool start!")},cancel:function(){console.log("Examp-Tool start!")},onUpdate:function(){console.log("Examp-Tool start!")}},{},e),n}])}(window.angular),function(e){e.module("angularCesium").directive("zoomWidget",["$document",function(n){return{replace:!0,require:"^tool",template:'<div class="zoom-widget"><div class="zoom-in-btn"><button type="button" class="btn btn-default" ng-click="zoomIn();"><span class="glyphicon glyphicon-zoom-in" aria-hidden="true"></span></button></div><div class="slider"><span class="bar"></span><span class="pointer"></span></div><div class="zoom-out-btn"><button type="button" class="btn btn-default" ng-click="zoomOut();"><span class="glyphicon glyphicon-zoom-out" aria-hidden="true"></span></button></div></div>',link:function(o,t,i){var r=isFinite(i.min)?Number.parseInt(i.min):0,l=isFinite(i.max)?Number.parseInt(i.max):100;if(0>r||0>l||r>=l)throw new Error("min or max attrs value are invalid.");var a=90/(l-r),u=(l-r)/2,c=(l+r)/2,s=45,m=e.element(t.find("span")[2]);m.css("top",u*a+"%");var d=null,f=10*m[0].clientHeight,g=s;m.on("mousedown",function(e){e.preventDefault(),d=e.clientY,g=s,m.addClass("active")}),n.on("mouseup",function(){null!==d&&(d=null,m.removeClass("active"),console.log(c))}),n.on("mousemove",function(e){if(null!==d){var n=d-e.clientY,o=100*Math.abs(n)/f;s=n>0?g-o>=0?g-o:0:90>=g+o?g+o:90,u=Math.trunc(s/a),c=l-u,m.css("top",u*a+"%")}}),o.zoomIn=function(){l>c&&(c++,u--,s=u*a,m.css("top",s+"%"),console.log(c))},o.zoomOut=function(){c>r&&(c--,u++,s=u*a,m.css("top",s+"%"),console.log(c))}}}}])}(window.angular);