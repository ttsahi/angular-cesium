"use strict";angular.module("angularCesium",["observableCollection"]),angular.module("angularCesium").service("BillBoardAttributes",["$parse",function(e){this.calcAttributes=function(t,o){var n={image:e(t.image)(o)},i=e(t.position)(o);n.position=Cesium.Cartesian3.fromDegrees(Number(i.latitude)||0,Number(i.longitude)||0,Number(i.altitude)||0);var r=e(t.color)(o);return r&&(n.color=Cesium.Color.fromCssColorString(r)),n}}]),angular.module("angularCesium").factory("Cesium",function(){return Cesium}),function(e){e.module("angularCesium").factory("Tool",[function(){var e=function(e){this._map=e};return $traceurRuntime.createClass(e,{start:function(){throw"No implementation"},stop:function(){throw"No implementation"},cancel:function(){throw"No implementation"},onUpdate:function(){throw"No implementation"}},{}),e}])}(window.angular),angular.module("angularCesium").directive("billboard",["BillBoardAttributes",function(e){return{restrict:"E",require:"^billboardsLayer",link:function(t,o,n,i){var r=e.calcAttributes(n,t),l=i.getBillboardCollection().add(r);t.$on("$destroy",function(){i.getBillboardCollection().remove(l)})}}}]),angular.module("angularCesium").directive("billboardsLayer",["$parse","ObservableCollection","BillBoardAttributes","Cesium",function(e,t,o,n){return{restrict:"E",require:"^map",controller:["$scope","$attrs",function(e,t){this.getBillboardCollection=function(){if(t.observableCollection)throw new Error("cannot get collection if layer is bound to ObservableCollection");return e.collection}}],link:{pre:function(i,r,l,u){if(i.collection=new n.BillboardCollection,l.observableCollection){var a=/\s*([\$\w][\$\w]*)\s+in\s+([\$\w][\$\w]*)/,c=l.observableCollection.match(a),s=c[1],m=e(c[2])(i);if(!m instanceof t)throw new Error("observable-collection must be of type ObservableCollection.");var d=function(e){var t={};t[s]=e;var n=o.calcAttributes(l,t);i.collection.add(n)};angular.forEach(m.getData(),function(e){d(e)}),m.onAdd(d),m.onUpdate(function(){}),m.onRemove(function(e,t){i.collection.remove(i.collection.get(t))})}u.getCesiumWidget().scene.primitives.add(i.collection),i.$on("$destroy",function(){u.getCesiumWidget().scene.primitives.remove(i.collection)})}}}}]),angular.module("angularCesium").directive("complexLayer",["$log",function(e){return{restrict:"E",require:"^map",compile:function(t,o){o.observableCollection&&angular.forEach(t.children(),function(o){var n=void 0;"BILLBOARD"===o.tagName?n=angular.element("<billboards-layer></billboards-layer>"):"LABEL"===o.tagName&&(n=angular.element("<labels-layer></labels-layer>")),n?(angular.forEach(o.attributes,function(e){n.attr(e.name,e.value)}),angular.forEach(t[0].attributes,function(e){angular.element(o).attr(e.name)||n.attr(e.name,e.value)}),angular.element(o).replaceWith(n)):(e.warn("Found an unknown child of of complex-layer. Removing..."),angular.element(o).remove())})}}}]),angular.module("angularCesium").directive("label",function(){return{restrict:"E",require:"^labelsLayer",scope:{color:"&",text:"&",position:"&"},link:function(e,t,o,n){var i={},r=e.position();i.position=Cesium.Cartesian3.fromDegrees(Number(r.latitude)||0,Number(r.longitude)||0,Number(r.altitude)||0);var l=e.color();l&&(i.color=l),i.text=e.text();var u=n.getLabelCollection().add(i);e.$on("$destroy",function(){n.getLabelCollection().remove(u)})}}}),angular.module("angularCesium").directive("labelsLayer",function(){return{restrict:"E",require:"^map",scope:{},controller:["$scope",function(e){this.getLabelCollection=function(){return e.collection}}],link:{pre:function(e,t,o,n){e.collection=new Cesium.LabelCollection,n.getCesiumWidget().scene.primitives.add(e.collection),e.$on("$destroy",function(){n.getCesiumWidget().scene.primitives.remove(e.collection)})}}}}),angular.module("angularCesium").directive("map",function(){function e(e){return 2==e?Cesium.SceneMode.SCENE2D:2.5==e?Cesium.SceneMode.COLUMBUS_VIEW:Cesium.SceneMode.SCENE3D}return{restrict:"E",template:'<div> <ng-transclude></ng-transclude> <div class="map-container"></div> </div>',transclude:!0,scope:{dimensions:"@"},controller:["$scope",function(e){this.getCesiumWidget=function(){return e.cesium},e.onDrop=function(){}}],link:{pre:function(t,o){t.dimensions||(t.dimensions=3),t.cesium=new Cesium.CesiumWidget(o.find("div")[0],{sceneMode:e(t.dimensions)}),t.mapRect=o[0].getBoundingClientRect()}}}}),angular.module("angularCesium").directive("polyline",function(){return{restrict:"E",require:"^polylinesLayer",scope:{color:"&",width:"&",positions:"&"},link:function(e,t,o,n){var i={};if(!angular.isDefined(e.positions)||!angular.isFunction(e.positions))throw"Polyline positions must be defined as a function";var r=e.positions();i.positions=[],angular.forEach(r,function(e){i.positions.push(Cesium.Cartesian3.fromDegrees(Number(e.latitude)||0,Number(e.longitude)||0,Number(e.altitude)||0))});var l=Cesium.Color.fromCssColorString("black");angular.isDefined(e.color)&&angular.isFunction(e.color)&&(l=Cesium.Color.fromCssColorString(e.color())),i.material=Cesium.Material.fromType("Color"),i.material.uniforms.color=l,i.width=1,angular.isDefined(e.width)&&angular.isFunction(e.width)&&(i.width=e.width());var u=n.getPolylineCollection().add(i);e.$on("$destroy",function(){n.getPolylineCollection().remove(u)})}}}),angular.module("angularCesium").directive("polylinesLayer",function(){return{restrict:"E",require:"^map",scope:{},controller:["$scope",function(e){this.getPolylineCollection=function(){return e.collection}}],link:{pre:function(e,t,o,n){e.collection=new Cesium.PolylineCollection,n.getCesiumWidget().scene.primitives.add(e.collection),e.$on("$destroy",function(){n.getCesiumWidget().scene.primitives.remove(e.collection)})}}}}),function(e){e.module("angularCesium").directive("toolBar",[function(){return{require:"^map",transclude:!0,template:'<div ng-transclude=""></div>',controller:["$scope",function(e){var t=null;this.getCesiumWidget=function(){return e.getCesiumWidget()},this.startTool=function(e){null!==t&&t.stop(),t=e,t.start()}}],link:{pre:function(e,t,o,n){e.getCesiumWidget=n.getCesiumWidget}}}}])}(window.angular),function(e){e.module("angularCesium").directive("tool",["Tool",function(e){return{replace:!0,require:"^toolBar",template:'<div ng-include="template"></div>',scope:{type:"=",template:"@"},link:function(t,o,n,i){if("function"!=typeof t.type)throw new TypeError("type attr must be constructor.");var r=new t.type(i.getCesiumWidget());if(!(r instanceof e))throw new TypeError("tool must be instance of Tool.");var l,u={},a=function(e){return"start"===e?0:void Object.defineProperty(u,e,{get:function(){return r[e]},set:function(t){r[e]=t}})};e:for(var c in r)switch(l=a(c)){case 0:continue e}Object.defineProperty(u,"start",{get:function(){return function(){return i.startTool(r)}}}),t.tool=u}}}])}(window.angular),angular.module("angularCesium").directive("draggable",["$document",function(e){return function(t,o){function n(e){c=e.pageY-u,a=e.pageX-l,r()?(s=a,m=c):v.css({top:m+"px",left:s+"px"})}function i(){o.css({cursor:"-webkit-grab"}),e.off("mousemove",n),e.off("mouseup",i)}function r(){return v.css({top:c+"px",left:a+"px"}),C=v[0].getBoundingClientRect(),C.top<p.top||C.left<p.left||C.right>p.right||C.bottom>p.bottom?!1:!0}var l=0,u=0,a=0,c=0,s=0,m=0,d=-1,g=-1,f=t.$parent.mapRect,p={},C={},v=o.parent();o.on("mousedown",function(t){t.preventDefault(),-1==d?(d=v[0].offsetTop,g=v[0].offsetLeft,p.top=d+f.top,p.left=g+f.left,p.right=g+f.right-5,p.bottom=d+f.bottom-15,C=v[0].getBoundingClientRect(),console.log("draggable2",p)):(d=0,g=0),l=t.pageX-a-g,u=t.pageY-c-d,o.css({cursor:"-webkit-grabbing"}),e.on("mousemove",n),e.on("mouseup",i)})}}]),angular.module("angularCesium").directive("toolbar",function(){return{restrict:"E",template:'<div class="toolbar" ><div class="drag-button glyphicon glyphicon-minus" draggable></div> <ng-transclude></ng-transclude></div>',transclude:!0,require:"^map",controller:["$scope",function(){this.currentTool=null,this.switchTool=function(e){null!=this.currentTool&&this.currentTool.stop(),this.currentTool=e,this.currentTool.start()}}],link:{post:function(){}}}}),angular.module("angularCesium").directive("webMapServiceLayer",function(){return{restrict:"E",require:"^map",scope:{url:"&",layers:"&"},controller:["$scope",function(){}],link:function(e,t,o,n){var i=new Cesium.WebMapServiceImageryProvider({url:e.url(),layers:e.layers()}),r=n.getCesiumWidget().scene.imageryLayers.addImageryProvider(i);e.$on("$destroy",function(){n.getCesiumWidget().scene.imageryLayers.remove(r)})}}});